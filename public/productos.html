<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CRUD de Productos</title>
    <link rel="stylesheet" href="styles-productos.css">
</head>
<body>
    <h1>CRUD de Productos</h1>
    <div id="productos">
        <h2>Gestión de Productos</h2>
        <button onclick="window.location.href='productos-agregar.html'">Agregar Producto</button>
        <!-- Tabla para listar productos -->
        <table>
            <thead>
                <tr>
                    <th>ID</th>
                    <th>Nombre</th>
                    <th>Precio</th>
                    <th>Stock</th>
                    <th>Acciones</th>
                </tr>
            </thead>
            <tbody id="productos-list">
                <!-- Los productos se cargarán aquí dinámicamente -->
            </tbody>
        </table>
    </div>
    <button onclick="window.location.href='/'">Volver al Inicio</button>
    <script>
        // Función para listar productos
        function listarProductos() {
            fetch('/productos')
                .then(response => response.json())
                .then(data => {
                    const tbody = document.getElementById('productos-list');
                    tbody.innerHTML = ''; // Limpiar la tabla
                    data.forEach(producto => {
                        const row = document.createElement('tr');
                        row.innerHTML = `
                            <td>${producto.id}</td>
                            <td>${producto.nombre}</td>
                            <td>${producto.precio}</td>
                            <td>${producto.stock}</td>
                            <td>
                                <button onclick="redirigirEditarProducto(${producto.id})">Editar</button>
                                <button onclick="eliminarProducto(${producto.id})">Eliminar</button>
                            </td>
                        `;
                        tbody.appendChild(row);
                    });
                })
                .catch(err => console.error('Error al listar productos:', err));
        }

        // Función para redirigir al formulario de edición con los datos del producto
        function redirigirEditarProducto(id) {
            window.location.href = `productos-editar.html?id=${id}`;
        }

        // Función para eliminar un producto
        function eliminarProducto(id) {
            fetch(`/productos/${id}`, {
                method: 'DELETE'
            })
                .then(response => response.json())
                .then(data => {
                    alert(data.message);
                    listarProductos(); // Actualizar la lista
                })
                .catch(err => console.error('Error al eliminar producto:', err));
        }

        // Llamar a la función para listar productos al cargar la página
        listarProductos();
    </script>
</body>
</html>
